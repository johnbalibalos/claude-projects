# Flow Cytometry Gating Benchmark Report

**Generated:** 2026-01-07 08:22:02
**Model:** claude-sonnet-4-20250514
**Test Cases:** 30

---

## Executive Summary

The benchmark evaluated an LLM's ability to predict flow cytometry gating hierarchies
from panel information. Key findings:

| Metric | Score | Assessment |
|--------|-------|------------|
| Hierarchy F1 | 38.9% | Needs Improvement |
| Structure Accuracy | 68.1% | Moderate |
| Critical Gate Recall | 44.4% | Needs Improvement |
| Hallucination Rate | 13.3% | Low (Good) |
| Parse Success | 100.0% | Excellent |

---

## Key Conclusions

### 1. Overall Performance
- The model achieved **38.9% F1 score** on gate name prediction
- **100%** of responses were valid, parseable JSON hierarchies
- Structure accuracy (68.1%) indicates moderate understanding of gating logic

### 2. Strengths
- ✓ Low hallucination rate (13.3%) - model uses actual panel markers
- ✓ High parse success rate - follows JSON output format well
- ✓ Reasonable hierarchy depth and structure

### 3. Weaknesses
- ✗ Missing critical QC gates (44.4% recall)
- ✗ Gate naming inconsistencies (e.g., "Singlets (SSC)" vs "Singlets")
- ✗ Over-generates subset populations not in ground truth

### 4. Most Commonly Missing Critical Gates
- **Singlets**: missed in 26/30 test cases
- **CD45+**: missed in 17/30 test cases
- **Time**: missed in 7/30 test cases
- **Lymphocytes**: missed in 3/30 test cases
- **CD45+ TILs**: missed in 2/30 test cases

### 5. Common Hallucinations
- **CD8+ Naive**: appeared in 7 predictions
- **CD8+ T Cells**: appeared in 7 predictions
- **Non-T Cells**: appeared in 7 predictions
- **CD8+ Central Memory**: appeared in 5 predictions
- **CD8+ Effector Memory**: appeared in 5 predictions

---

## Performance by Test Case

| Test Case | Colors | F1 | Structure | Critical | Notes |
|-----------|--------|-----|-----------|----------|-------|
| OMIP-013 | - | 43.8% | 20.0% | 33.3% | 5 missing, 13 extra |
| OMIP-032 | - | 12.5% | 100.0% | 33.3% | 12 missing, 16 extra |
| OMIP-007 | - | 31.6% | 50.0% | 66.7% | 6 missing, 7 extra |
| OMIP-030 | - | 33.3% | 100.0% | 33.3% | 7 missing, 13 extra |
| OMIP-062 | - | 19.2% | 100.0% | 33.3% | 11 missing, 31 extra |
| OMIP-066 | - | 43.9% | 100.0% | 33.3% | 5 missing, 18 extra |
| OMIP-041 | - | 55.6% | 100.0% | 66.7% | 2 missing, 14 extra |
| OMIP-001 | - | 51.9% | 75.0% | 100.0% | 5 missing, 8 extra |
| OMIP-003 | - | 63.6% | 33.3% | 66.7% | 1 missing, 7 extra |
| OMIP-035 | - | 31.8% | 100.0% | 33.3% | 9 missing, 21 extra |
| OMIP-044 | - | 44.4% | 50.0% | 25.0% | 5 missing, 10 extra |
| OMIP-058 | - | 30.2% | 100.0% | 50.0% | 14 missing, 23 extra |
| OMIP-064 | - | 42.6% | 66.7% | 25.0% | 6 missing, 21 extra |
| OMIP-021 | - | 34.3% | 40.0% | 66.7% | 4 missing, 19 extra |
| OMIP-025 | - | 58.1% | 25.0% | 66.7% | 5 missing, 8 extra |
| OMIP-015 | - | 53.3% | 40.0% | 66.7% | 2 missing, 12 extra |
| OMIP-039 | - | 39.1% | 100.0% | 33.3% | 4 missing, 24 extra |
| OMIP-043 | - | 35.9% | 25.0% | 33.3% | 7 missing, 18 extra |
| OMIP-060 | - | 33.3% | 50.0% | 25.0% | 5 missing, 31 extra |
| OMIP-072 | - | 37.2% | 50.0% | 25.0% | 3 missing, 24 extra |
| OMIP-005 | - | 19.4% | 100.0% | 33.3% | 6 missing, 19 extra |
| OMIP-023 | - | 53.3% | 50.0% | 50.0% | 3 missing, 11 extra |
| OMIP-017 | - | 40.0% | 80.0% | 66.7% | 6 missing, 12 extra |
| OMIP-011 | - | 25.0% | 100.0% | 33.3% | 6 missing, 18 extra |
| OMIP-027 | - | 28.0% | 50.0% | 33.3% | 12 missing, 24 extra |
| OMIP-019 | - | 46.8% | 50.0% | 33.3% | 5 missing, 20 extra |
| OMIP-069 | - | 68.2% | 77.8% | 40.0% | 5 missing, 9 extra |
| OMIP-070 | - | 32.7% | 50.0% | 25.0% | 3 missing, 30 extra |
| OMIP-009 | - | 42.9% | 60.0% | 66.7% | 5 missing, 11 extra |
| OMIP-037 | - | 13.8% | 100.0% | 33.3% | 9 missing, 16 extra |

---

## Cost Analysis

| Metric | Value |
|--------|-------|
| Input Tokens | 16,832 |
| Output Tokens | 54,510 |
| Total Tokens | 71,342 |
| **Total Cost** | **$0.8681** |
| Cost per Test Case | $0.0289 |

---

## Recommendations

1. **Improve QC Gate Emphasis**: Add explicit instructions to always include Time, Singlets, and Live/Dead gates
2. **Enhance Fuzzy Matching**: Accept gate name variants (e.g., "Lymphs" = "Lymphocytes")
3. **Constrain Output**: Consider providing a template or schema of expected gates
4. **Add Few-Shot Examples**: Include example hierarchies in the prompt
5. **Expand Ground Truth**: Add acceptable alternative gate names to test cases

---

## Appendix: Raw Metrics

```json
{
  "total": 30,
  "valid": 30,
  "parse_success_rate": 1.0,
  "hierarchy_f1_mean": 0.38852654515934343,
  "hierarchy_f1_min": 0.125,
  "hierarchy_f1_max": 0.6818181818181818,
  "hierarchy_precision_mean": 0.3083340063641173,
  "hierarchy_precision_min": 0.1111111111111111,
  "hierarchy_precision_max": 0.625,
  "hierarchy_recall_mean": 0.5507057489294331,
  "hierarchy_recall_min": 0.14285714285714285,
  "hierarchy_recall_max": 0.875,
  "structure_accuracy_mean": 0.680925925925926,
  "structure_accuracy_min": 0.2,
  "structure_accuracy_max": 1.0,
  "critical_gate_recall_mean": 0.443888888888889,
  "critical_gate_recall_min": 0.25,
  "critical_gate_recall_max": 1.0,
  "hallucination_rate_mean": 0.13349163483054838,
  "hallucination_rate_min": 0.0,
  "hallucination_rate_max": 0.5,
  "depth_accuracy_mean": 0.48607142857142843,
  "depth_accuracy_min": 0.0,
  "depth_accuracy_max": 0.875
}
```
