# Flow Cytometry Gating Benchmark Report

**Generated:** 2026-01-07 08:02:44
**Model:** claude-sonnet-4-20250514
**Test Cases:** 2

---

## Executive Summary

The benchmark evaluated an LLM's ability to predict flow cytometry gating hierarchies
from panel information. Key findings:

| Metric | Score | Assessment |
|--------|-------|------------|
| Hierarchy F1 | 60.8% | Moderate |
| Structure Accuracy | 63.9% | Moderate |
| Critical Gate Recall | 45.0% | Needs Improvement |
| Hallucination Rate | 12.1% | Low (Good) |
| Parse Success | 100.0% | Excellent |

---

## Key Conclusions

### 1. Overall Performance
- The model achieved **60.8% F1 score** on gate name prediction
- **100%** of responses were valid, parseable JSON hierarchies
- Structure accuracy (63.9%) indicates moderate understanding of gating logic

### 2. Strengths
- ✓ Low hallucination rate (12.1%) - model uses actual panel markers
- ✓ High parse success rate - follows JSON output format well
- ✓ Reasonable hierarchy depth and structure

### 3. Weaknesses
- ✗ Missing critical QC gates (45.0% recall)
- ✗ Gate naming inconsistencies (e.g., "Singlets (SSC)" vs "Singlets")
- ✗ Over-generates subset populations not in ground truth

### 4. Most Commonly Missing Critical Gates
- **CD45+**: missed in 2/2 test cases
- **Lymphocytes**: missed in 1/2 test cases
- **Time**: missed in 1/2 test cases
- **Singlets**: missed in 1/2 test cases

### 5. Common Hallucinations
- **Non-T Cells**: appeared in 2 predictions
- **Non-classical Monocytes**: appeared in 1 predictions
- **Non-T Non-B Cells**: appeared in 1 predictions
- **Non-B Cells**: appeared in 1 predictions

---

## Performance by Test Case

| Test Case | Colors | F1 | Structure | Critical | Notes |
|-----------|--------|-----|-----------|----------|-------|
| OMIP-023 | - | 53.3% | 50.0% | 50.0% | 3 missing, 11 extra |
| OMIP-069 | - | 68.2% | 77.8% | 40.0% | 5 missing, 9 extra |

---

## Cost Analysis

| Metric | Value |
|--------|-------|
| Input Tokens | 1,102 |
| Output Tokens | 3,202 |
| Total Tokens | 4,304 |
| **Total Cost** | **$0.0513** |
| Cost per Test Case | $0.0257 |

---

## Recommendations

1. **Improve QC Gate Emphasis**: Add explicit instructions to always include Time, Singlets, and Live/Dead gates
2. **Enhance Fuzzy Matching**: Accept gate name variants (e.g., "Lymphs" = "Lymphocytes")
3. **Constrain Output**: Consider providing a template or schema of expected gates
4. **Add Few-Shot Examples**: Include example hierarchies in the prompt
5. **Expand Ground Truth**: Add acceptable alternative gate names to test cases

---

## Appendix: Raw Metrics

```json
{
  "total": 2,
  "valid": 2,
  "parse_success_rate": 1.0,
  "hierarchy_f1_mean": 0.6075757575757575,
  "hierarchy_f1_min": 0.5333333333333333,
  "hierarchy_f1_max": 0.6818181818181818,
  "hierarchy_precision_mean": 0.5230263157894737,
  "hierarchy_precision_min": 0.42105263157894735,
  "hierarchy_precision_max": 0.625,
  "hierarchy_recall_mean": 0.7386363636363636,
  "hierarchy_recall_min": 0.7272727272727273,
  "hierarchy_recall_max": 0.75,
  "structure_accuracy_mean": 0.6388888888888888,
  "structure_accuracy_min": 0.5,
  "structure_accuracy_max": 0.7777777777777778,
  "critical_gate_recall_mean": 0.45,
  "critical_gate_recall_min": 0.4,
  "critical_gate_recall_max": 0.5,
  "hallucination_rate_mean": 0.12061403508771928,
  "hallucination_rate_min": 0.08333333333333333,
  "hallucination_rate_max": 0.15789473684210525,
  "depth_accuracy_mean": 0.7083333333333334,
  "depth_accuracy_min": 0.6666666666666667,
  "depth_accuracy_max": 0.75
}
```
